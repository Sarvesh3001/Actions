name: Deploy to OCI

on:
  push:
    branches:
      - main

env:
  OCI_USERNAME: ${{ secrets.OCI_USERNAME }}
  OCI_PASSWORD: ${{ secrets.OCI_PASSWORD }}

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install OCI CLI
      run: |
        sudo apt-get update
        sudo apt-get install -y wget unzip
        wget https://github.com/oracle/oci-cli/releases/download/v2.9.14/oci-cli-v2.9.14.zip
        unzip oci-cli-v2.9.14.zip
        sudo mv oci /usr/local/bin

    - name: Deploy to OCI
      run: |
        echo ${OCI_PASSWORD} | oci --auth instance_principal --profile default login
        oci functions action invoke --function-id <function_id> --input '{}'
